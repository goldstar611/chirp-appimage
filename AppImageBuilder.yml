version: 1
script:
  # Remove any previous build
  - rm -rf AppDir  | true

AppDir:
  path: ./AppDir
  
  after_bundle:
    - |
      cd chirp/
      python2.7 setup.py install --prefix=/usr --root=../AppDir
      
  after_runtime:
    - mkdir -p $TARGET_APPDIR/usr/share/gtk-2.0
    - echo include \"/usr/share/themes/Adwaita/gtk-2.0/gtkrc\" > $TARGET_APPDIR/usr/share/gtk-2.0/gtkrc
    - cp loaders.cache $TARGET_APPDIR/usr/lib/*/gdk-pixbuf-2.0/2.10.0/loaders.cache

  app_info:
    id: com.danplanet.chirp
    name: Chirp
    icon: chirp
    version: ${CHIRP_VERSION}
    exec: usr/bin/python2.7
    exec_args: "$APPDIR/usr/bin/chirpw $@"

  apt:
    arch: ${TARGET_ARCH_APT}
    sources:
      - sourceline: ${SOURCE_LINE_1}
        key_url: ${KEY_URL_1}

    include:
      - python-cairo
      - python-gobject-2
      - python-gtk2
      - python-serial
      - python-future
      - python-suds
      - python2.7-minimal
      - libxml2
      - gnome-themes-extra
      - adwaita-icon-theme
      - fontconfig
      - fontconfig-config
      - appmenu-gtk2-module
      - libcanberra-gtk-module
      - libgail-common
      - libatk-adaptor
    exclude:
      - libicu60
      - humanity-icon-theme

  files:
    exclude:
      - usr/lib/x86_64-linux-gnu/gconv
      - usr/share/man
      - usr/share/doc/
      - usr/include
      - usr/share/icons/ubuntu-mono-*

  runtime:
    path_mappings:
      - /usr/share/gtk-2.0/:$APPDIR/usr/share/gtk-2.0/
      - /usr/share/themes/:$APPDIR/usr/share/themes/
      - /usr/share/icons/:$APPDIR/usr/share/icons/
      - /etc/fonts/:$APPDIR/etc/fonts/
      - /etc/fonts/conf.d/:$APPDIR/etc/fonts/conf.d/
      - /etc/fonts/conf.avail/:$APPDIR/etc/fonts/conf.avail/

    env:
      PYTHONHOME: $APPDIR/usr
      PYTHONPATH: $APPDIR/usr/lib/python2.7/site-packages
      XDG_DATA_DIRS: $APPDIR/share:$XDG_DATA_DIRS
      FONTCONFIG_FILE: $APPDIR/etc/fonts/fonts.conf
      FONTCONFIG_PATH: $APPDIR/etc/fonts

AppImage:
  sign-key: None
  # https://github.com/AppImage/AppImageKit/releases/
  arch: ${TARGET_ARCH_APPIMAGE}

